<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<title>BQNsweeper</title>
<style>
@font-face{
  font-family: BQN386;
  src: url(/BQN386.subset.woff2) format('woff2');
}
pre,code,textarea {
  font-family: BQN386, monospace;
}
textarea, button {
  font-size: 1.2rem;
  line-height: 1.4;
}
#grid > button {
  width: 30px;
  height: 30px;
  padding: 0;
  vertical-align: bottom;
}
</style>
</head>

<body>
<div id="grid"><div>
<pre id="src"></pre>

<script src="bqn.js"></script>
<script>
  const src = `
  Grid â† {ğ•©â¥Š(â†•Ã—Â´ğ•©)âˆŠğ•¨â€¢rand.Deal Ã—Â´ğ•©}
  Pad â† {0âˆ¾Ë˜â‰âŒ½ğ•©}âŸ4
  Adjacent â† Â¬Ã—Â·+Â´âˆ˜â¥Šâ‰2 3â€¿3â†•Pad
  Spread â† {â‰âŒ½ğ•©âˆ¨Â»ğ•©}âŸ4
  Flood â† âˆ§âŸœSpreadâŸ{+Â´â‰¢ğ•©}

  Game â† {count ğ•Š size:
    mines â† count Grid size
    adj â† Adjacent mines
    seen â† sizeâ¥Š0
    Guess â‡ {ğ•Š xâ€¿y:
      guessArray â† (<yâ€¿x)â‰¡Â¨â†•size
      seen â†© seen âˆ¨ guessArray âˆ¨ Spread (0=adj+mines) Flood guessArray
    }
    Render â‡ {ğ•Š: âŠ‘âŸœ".x 12345678"Â¨seenÃ—seen+1+adj-mines}
    Result â‡ {ğ•Š: (seenâ‰¡Â¬mines) - âˆ¨Â´â¥Šseenâˆ§mines}
  }`

  const v = 8
  const h = 8

  let Game = run.apply(null, compile(src))
  let obj = Game(list([h,v]), 10)
  let ns = nsget(obj);
  let render = ns("render")
  let result = ns("result")
  let guess = ns("guess")

  document.getElementById("src").innerText = src

  for (let i=0; i<v; i++) {
    for (let j=0; j<h; j++) {
      let btn = document.createElement("button")
      btn.id = "btn-" + (i * h + j)
        btn.innerText = "."
        btn.addEventListener("click", () => {
          guess(list([j,i]))
          update()
        })
      grid.appendChild(btn)
    }
    grid.appendChild(document.createElement("br"))
  }

  function update() {
    let g = render()
    for (i=0; i<v*h; i++) {
      document.getElementById("btn-" + i).innerText = g[i]
    }
  }
  
</script>

</body>
</html>
